document.addEventListener('DOMContentLoaded', function() {
  const PrevImg = document.querySelector('#prev_img');
  const DeleteBtnArea = document.querySelector('.delete-preview');
  const DeleteBtn = document.querySelector('.fa-times');
  const AvatarInput = document.querySelector('#user_avatar');
  const AvatarInputArea = document.querySelector('.input-area');
  const sampleImagePath = '<%= asset_path('sample.png') %>';
  const avatarUrl = document.querySelector('#prev_img').dataset.avatarUrl;
  
  // 初期表示の設定
  if (window.innerWidth >= 450) {
    PrevImg.classList.add('upsize');
    PrevImg.classList.remove('downsize');
    DeleteBtn.classList.add('fa-2x', 'py-1');
    DeleteBtn.classList.remove('fa-lg', 'py-3');
    AvatarInputArea.classList.add('avatar-input-upsize');
    AvatarInputArea.classList.remove('avatar-input-downsize');
  } else if (window.innerWidth >= 360) {
    PrevImg.classList.add('downsize');
    PrevImg.classList.remove('upsize');
    DeleteBtn.classList.add('fa-lg', 'py-3');
    DeleteBtn.classList.remove('fa-2x', 'py-1');
    AvatarInputArea.classList.add('avatar-input-downsize');
    AvatarInputArea.classList.remove('avatar-input-upsize');
  } else {
    PrevImg.classList.add('more-downsize');
    PrevImg.classList.remove('downsize');
    AvatarInputArea.classList.add('avatar-input-more-downsize');
    AvatarInputArea.classList.remove('avatar-input-downsize');
  }

  // 画面サイズが変更された時にプレビューのサイズを切り替える
  window.addEventListener('resize', function() {
    if (window.innerWidth >= 450) {
        PrevImg.classList.add('upsize');
        PrevImg.classList.remove('downsize', 'more-downsize');
        DeleteBtn.classList.add('fa-2x', 'py-1');
        DeleteBtn.classList.remove('fa-lg', 'py-3', 'py-4');
        AvatarInputArea.classList.add('avatar-input-upsize');
        AvatarInputArea.classList.remove('avatar-input-downsize', 'avatar-input-more-downsize');
    } else if (window.innerWidth >= 370) {
        PrevImg.classList.add('downsize');
        PrevImg.classList.remove('upsize', 'more-downsize');
        DeleteBtn.classList.add('fa-lg', 'py-3');
        DeleteBtn.classList.remove('fa-2x', 'py-1', 'py-4');
        AvatarInputArea.classList.add('avatar-input-downsize');
        AvatarInputArea.classList.remove('avatar-input-upsize', 'avatar-input-more-downsize');
    } else if (window.innerWidth <= 369) {
        PrevImg.classList.add('more-downsize');
        PrevImg.classList.remove('downsize', 'upsize');
        AvatarInputArea.classList.add('avatar-input-more-downsize');
        AvatarInputArea.classList.remove('avatar-input-downsize', 'avatar-input-upsize');
    }
  });


  $(function() {
    function readURL(input) {
      if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {
          $('#prev_img').attr('src', e.target.result);
        }
        reader.readAsDataURL(input.files[0]);
      }
    }
    $("#user_avatar").change(function() {
      readURL(this);
      DeleteBtnArea.classList.add('open');
    });

    DeleteBtnArea.addEventListener('click', function() {
      // プレビューを削除
      PrevImg.src = avatarUrl || sampleImagePath;
      // ×ボタンを非表示
      DeleteBtnArea.classList.remove('open');
      // アップロードファイルをクリア
      AvatarInput.value = null;
    });
  });
});